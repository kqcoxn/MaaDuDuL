# 项目接口协议

<cite>
**本文档引用文件**  
- [interface.json](file://assets/interface.json)
- [3.3-ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md)
- [每日采购.json](file://MFAAvalonia/resource/base/pipeline/日常任务/每日采购.json)
- [圣团巡礼.json](file://MFAAvalonia/resource/base/pipeline/日常任务/圣团巡礼.json)
- [清紫糖.json](file://MFAAvalonia/resource/base/pipeline/日常任务/清紫糖.json)
- [purchase.md](file://descs/daily/purchase.md)
- [claim_mail.md](file://descs/daily/claim_mail.md)
- [claim_candy.md](file://descs/daily/claim_candy.md)
- [claim_reward.md](file://descs/daily/claim_reward.md)
</cite>

## 目录
1. [项目接口V2协议概述](#项目接口v2协议概述)
2. [核心字段解析](#核心字段解析)
3. [任务配置结构详解](#任务配置结构详解)
4. [选项配置机制](#选项配置机制)
5. [输入类型参数验证与管道传递](#输入类型参数验证与管道传递)
6. [任务流程分支控制](#任务流程分支控制)
7. [周期检查与商店采购配置](#周期检查与商店采购配置)

## 项目接口V2协议概述

项目接口V2协议（Project Interface V2）是MaaFramework的标准化项目结构声明，通过`interface.json`文件定义项目元数据、控制器配置、资源路径等核心信息。该协议支持多语言、资源覆盖、任务配置和选项管理，为自动化任务提供统一的配置框架。

**Section sources**
- [3.3-ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md#L1-L637)

## 核心字段解析

项目接口V2协议的核心字段包括接口版本、应用元数据、控制器配置和资源路径：

- **interface_version**: 接口版本号，当前为2，用于标识协议版本
- **name**: 项目唯一标识符，用作项目ID
- **title**: 窗口标题，直接显示在客户端
- **icon**: 应用图标文件路径，相对于项目根目录
- **description**: 项目描述信息，显示在"关于"页面
- **version**: 项目版本号，用于版本更新检查
- **welcome**: 欢迎消息，在用户首次使用时弹窗显示
- **contact**: 联系方式信息，显示在"关于"页面
- **license**: 项目许可证信息，显示在"关于"页面
- **github**: 项目GitHub仓库地址，用于版本更新检查
- **mirrorchyan_rid**: MirrorChyan资源包标识符
- **mirrorchyan_multiplatform**: 是否支持多平台

控制器配置（controller）定义了预设的控制器信息，包括名称、类型和显示短边长度。资源配置（resource）定义了资源加载路径，支持资源覆盖机制。

**Section sources**
- [interface.json](file://assets/interface.json#L1-L38)
- [3.3-ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md#L25-L204)

## 任务配置结构详解

任务配置（task）是项目接口V2协议的核心部分，定义了可执行任务的信息：

- **name**: 任务唯一标识符，用作任务ID
- **label**: 任务显示名称，用于在用户界面中展示
- **entry**: 任务入口，为pipeline中Task的名称
- **default_check**: 是否默认选中该任务
- **description**: 任务详细描述信息，帮助用户理解任务功能
- **option**: 任务配置项，引用option对象中的键值

任务配置通过`entry`字段关联到具体的流水线任务，通过`option`字段关联到可配置的选项。例如，"启动游戏"任务的entry为"启动游戏_开始"，表示从该节点开始执行任务流程。

**Section sources**
- [interface.json](file://assets/interface.json#L39-L163)
- [3.3-ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md#L254-L322)

## 选项配置机制

选项配置（option）定义了任务的可配置参数，支持三种类型：select（下拉选项框）、input（用户输入框）和switch（选择框）。每种类型都有特定的配置逻辑：

### Switch类型配置逻辑

Switch类型选项用于二元选择（Yes/No），通过`cases`数组定义两个选项。当`case.name`为"Yes"、"yes"、"Y"或"y"时，该case被识别为Yes选项；当`case.name`为"No"、"no"、"N"或"n"时，该case被识别为No选项。

Switch选项的关键特性是`pipeline_override`字段，用于在选项激活时覆盖流水线配置。例如，"领取邮件-周期检查"选项在No情况下将"领取邮件_周期检查"任务的动作设置为"DoNothing"，从而跳过周期检查：

```json
"领取邮件-周期检查": {
    "type": "switch",
    "label": "每日仅检查一次邮箱",
    "cases": [
        {
            "name": "No",
            "pipeline_override": {
                "领取邮件_周期检查": {
                    "action": "DoNothing"
                }
            }
        },
        {
            "name": "Yes"
        }
    ]
}
```

**Section sources**
- [interface.json](file://assets/interface.json#L164-L201)
- [3.3-ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md#L331-L357)

## 输入类型参数验证与管道传递

Input类型选项允许用户手动输入内容，通过`inputs`数组定义输入字段。每个输入字段包含以下属性：

- **name**: 输入字段唯一标识符
- **label**: 输入字段显示名称
- **default**: 输入字段的默认值
- **pipeline_type**: 输入字段在pipeline_override中的数据类型（string、int、bool）
- **verify**: 正则表达式，用于校验用户输入是否合法
- **pattern_msg**: 正则校验用户输入错误时显示的信息

Input选项通过`pipeline_override`字段实现管道传递，支持在字符串中使用`{名称}`格式引用输入字段的值。例如，"清紫糖-克隆工厂-选择关卡"选项将用户输入的关卡号传递给自定义动作参数：

```json
"清紫糖-克隆工厂-选择关卡": {
    "type": "input",
    "label": "克隆工厂关卡",
    "inputs": [
        {
            "name": "关卡",
            "label": "克隆工厂关卡",
            "default": "1",
            "pipeline_type": "string",
            "verify": "^\\d+$"
        }
    ],
    "pipeline_override": {
        "清紫糖_选择克隆工厂关卡": {
            "custom_action_param": "l={关卡}"
        }
    }
}
```

**Section sources**
- [interface.json](file://assets/interface.json#L767-L785)
- [3.3-ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md#L387-L421)

## 任务流程分支控制

任务流程分支通过选项的嵌套配置实现，支持无限层级的子选项。当用户选择某个选项时，其`option`字段中引用的子选项会显示在用户界面中。

例如，"每日采购-周期免费礼包"选项在Yes情况下显示三个子选项："每日采购-每日免费礼包"、"每日采购-每周免费礼包"和"每日采购-每月免费礼包"。每个子选项又可以有自己的子选项，形成树状结构：

```json
"每日采购-周期免费礼包": {
    "type": "switch",
    "label": "周期免费礼包",
    "cases": [
        {
            "name": "Yes",
            "option": ["每日采购-每日免费礼包", "每日采购-每周免费礼包", "每日采购-每月免费礼包"]
        },
        {
            "name": "No",
            "pipeline_override": {
                "每日采购_尊享商店开始": {
                    "next": "每日采购_至尊商店结束"
                }
            }
        }
    ]
}
```

这种机制允许用户根据需要配置复杂的任务流程，如选择是否领取每日、每周和每月免费礼包。

**Section sources**
- [interface.json](file://assets/interface.json#L204-L220)
- [3.3-ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md#L380-L385)

## 周期检查与商店采购配置

周期检查和商店采购功能通过复杂的选项配置实现，结合了switch、input和select类型选项。

### 周期检查配置

周期检查通过`periodic_check`自定义动作实现，用于确保每日仅执行一次特定任务。例如，"领取邮件-周期检查"选项在No情况下将"领取邮件_周期检查"任务的动作设置为"DoNothing"，从而跳过周期检查：

```json
"领取邮件-周期检查": {
    "type": "switch",
    "label": "每日仅检查一次邮箱",
    "cases": [
        {
            "name": "No",
            "pipeline_override": {
                "领取邮件_周期检查": {
                    "action": "DoNothing"
                }
            }
        },
        {
            "name": "Yes"
        }
    ]
}
```

### 商店采购配置

商店采购配置展示了多层级选项的复杂应用。"每日采购-商店采购"选项在Yes情况下显示三个子选项："每日采购-商店采购-周期检查"、"每日采购-日常商店"和"每日采购-战斗宝石商店"。其中"每日采购-日常商店"选项又包含九个子选项，允许用户选择要购买的具体商品：

```json
"每日采购-商店采购": {
    "type": "switch",
    "label": "采购普通商店",
    "cases": [
        {
            "name": "No",
            "pipeline_override": {
                "每日采购_普通商店开始": {
                    "next": "每日采购_普通商店结束"
                }
            }
        },
        {
            "name": "Yes",
            "option": ["每日采购-商店采购-周期检查", "每日采购-日常商店", "每日采购-战斗宝石商店"]
        }
    ]
}
```

这种配置机制允许用户灵活控制商店采购的各个方面，包括是否进行周期检查、是否采购日常商店和战斗宝石商店，以及在日常商店中选择具体要购买的商品。

**Section sources**
- [interface.json](file://assets/interface.json#L94-L395)
- [每日采购.json](file://MFAAvalonia/resource/base/pipeline/日常任务/每日采购.json)
- [purchase.md](file://descs/daily/purchase.md)