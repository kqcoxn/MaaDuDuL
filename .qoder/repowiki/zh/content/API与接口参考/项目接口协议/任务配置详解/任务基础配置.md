# 任务基础配置

<cite>
**本文档引用文件**  
- [interface.json](file://assets/interface.json)
- [ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md)
- [启动游戏.json](file://assets/resource/base/pipeline/日常任务/启动游戏.json)
- [领取邮件.json](file://assets/resource/base/pipeline/日常任务/领取邮件.json)
- [圣团巡礼.json](file://assets/resource/base/pipeline/日常任务/圣团巡礼.json)
- [每日采购.json](file://assets/resource/base/pipeline/日常任务/每日采购.json)
- [清紫糖.json](file://assets/resource/base/pipeline/日常任务/清紫糖.json)
- [领取奖励.json](file://assets/resource/base/pipeline/日常任务/领取奖励.json)
- [巅峰对决.json](file://assets/resource/base/pipeline/日常任务/巅峰对决.json)
- [start_game.md](file://descs/daily/start_game.md)
- [claim_mail.md](file://descs/daily/claim_mail.md)
- [saint_tour.md](file://descs/daily/saint_tour.md)
</cite>

## 目录
1. [引言](#引言)
2. [核心配置字段解析](#核心配置字段解析)
   - [name 字段](#name-字段)
   - [label 字段](#label-字段)
   - [entry 字段](#entry-字段)
   - [default_check 字段](#default_check-字段)
   - [description 字段](#description-字段)
   - [resource 字段](#resource-字段)
3. [字段交互与任务执行流程](#字段交互与任务执行流程)
4. [结论](#结论)

## 引言
ProjectInterface V2协议定义了自动化任务系统的核心配置结构，通过`interface.json`文件中的`task`数组来声明可执行任务。本文档深入解析任务基础配置中的核心字段，包括`name`、`label`、`entry`、`default_check`、`description`和`resource`，并以`assets/interface.json`中定义的具体任务（如启动游戏、领取邮件、圣团巡礼等）为例，详细阐述这些字段的定义、作用及其在系统中的实际应用。

## 核心配置字段解析

### name 字段
`name`字段是任务的唯一标识符，作为任务的ID在系统内部使用。它必须是唯一的，用于在代码和配置中精确引用特定任务。在`interface.json`文件中，每个任务对象都通过其`name`值来区分。

例如，在`interface.json`中定义了多个任务，它们的`name`值各不相同：
- `"name": "启动游戏"`：标识启动游戏任务。
- `"name": "领取邮件"`：标识领取邮件任务。
- `"name": "圣团巡礼"`：标识圣团巡礼任务。

这些`name`值不仅在`interface.json`中用于区分任务，还作为`option`配置中的键名，实现任务与配置项的关联。例如，`"领取邮件-周期检查"`这个配置项就是通过`name`为`"领取邮件"`的任务的`option`字段来引用的。

**Section sources**
- [interface.json](file://assets/interface.json#L59-L162)

### label 字段
`label`字段定义了任务在用户界面中显示的名称。它直接决定了用户在操作界面上看到的任务标签，是用户与系统交互的重要视觉元素。

在`interface.json`中，`label`字段的值通常与`name`字段相似，但更注重可读性和用户体验。例如：
- `"name": "启动游戏", "label": "启动游戏"`：在界面上显示为“启动游戏”。
- `"name": "领取邮件", "label": "领取邮件"`：在界面上显示为“领取邮件”。
- `"name": "叶子互换", "label": "好友叶子互换"`：这里`label`比`name`更具描述性，明确指出是“好友”之间的叶子互换。

`label`字段支持国际化（以`$`开头），允许为不同语言环境提供本地化的显示文本，从而提升多语言用户的使用体验。

**Section sources**
- [interface.json](file://assets/interface.json#L60-L162)

### entry 字段
`entry`字段是任务的入口点，它精确指向`pipeline`（任务流水线）中的一个具体任务节点。该字段的值是`pipeline` JSON文件中某个任务节点的名称，系统通过此名称来启动和执行相应的任务流程。

以“启动游戏”任务为例：
- 在`interface.json`中，`"name": "启动游戏"`的任务，其`"entry": "启动游戏_开始"`。
- 在`assets/resource/base/pipeline/日常任务/启动游戏.json`文件中，可以找到名为`"启动游戏_开始"`的任务节点，其定义如下：
```json
"启动游戏_开始": {
    "action": {
        "param": {
            "custom_action": "on_task_start"
        },
        "type": "Custom"
    },
    "next": ["启动游戏_启动游戏"]
}
```
这表明，当用户选择执行“启动游戏”任务时，系统会从`启动游戏.json`流水线中的`启动游戏_开始`节点开始执行，然后根据`next`指令跳转到`启动游戏_启动游戏`节点，从而启动游戏应用。

**Section sources**
- [interface.json](file://assets/interface.json#L61-L162)
- [启动游戏.json](file://assets/resource/base/pipeline/日常任务/启动游戏.json#L108-L127)

### default_check 字段
`default_check`字段控制任务的默认启用状态。当该字段设置为`true`时，表示该任务在用户首次使用或初始化时会默认被选中并执行。这对于关键的日常任务至关重要，可以确保用户无需手动操作就能自动完成一系列基础维护工作。

在`interface.json`中，多个核心日常任务都设置了`default_check: true`：
- `"name": "启动游戏", "default_check": true`：确保每次使用时都自动启动游戏。
- `"name": "领取邮件", "default_check": true`：确保每日邮件奖励被自动领取。
- `"name": "叶子互换", "default_check": true`：确保好友间的日常互动自动完成。
- `"name": "领取糖果", "default_check": true`：确保每日糖果奖励被自动领取。
- `"name": "每日采购", "default_check": true`：确保日常采购任务自动执行。
- `"name": "圣团巡礼", "default_check": true`：确保圣团巡礼相关日常自动完成。
- `"name": "巅峰对决", "default_check": true`：确保巅峰对决任务自动执行。
- `"name": "领取奖励", "default_check": true`：确保各类任务奖励被自动领取。

这一设计极大地提升了用户体验，用户只需配置一次，系统便能自动处理所有常规的、重复性的日常任务。

**Section sources**
- [interface.json](file://assets/interface.json#L62-L128)

### description 字段
`description`字段用于提供任务的详细说明，支持文本、文件路径或URL。在本项目中，该字段的一个重要特性是支持文件路径引用，能够链接到`descs/`目录下的详细说明文档，从而实现内容与配置的分离，便于维护和更新。

在`interface.json`中，`description`字段的值以`Resource/descs/`开头，指向`descs`目录下的Markdown文件：
- `"name": "启动游戏", "description": "Resource/descs/daily/start_game.md"`：链接到`descs/daily/start_game.md`文件。
- `"name": "领取邮件", "description": "Resource/descs/daily/claim_mail.md"`：链接到`descs/daily/claim_mail.md`文件。
- `"name": "圣团巡礼", "description": "Resource/descs/daily/saint_tour.md"`：链接到`descs/daily/saint_tour.md`文件。

这些Markdown文件包含了任务的功能说明、起止界面和使用建议等丰富信息。例如，`start_game.md`文件中描述了“启动游戏”任务的功能是“启动游戏并进入主界面，处理启动过程中的各种弹窗和界面”，并建议“在每次执行日常任务前运行此任务”。

**Section sources**
- [interface.json](file://assets/interface.json#L63-L136)
- [start_game.md](file://descs/daily/start_game.md#L1-L17)
- [claim_mail.md](file://descs/daily/claim_mail.md#L1-L13)
- [saint_tour.md](file://descs/daily/saint_tour.md#L1-L13)

### resource 字段
`resource`字段用于实现任务与特定资源包的绑定。它是一个字符串数组，数组元素对应`resource`配置中的`name`字段。通过此字段，可以控制某个任务仅在特定的资源包下可用，从而实现功能模块的按需加载与环境适配。

在`interface.json`的`resource`配置中，定义了一个名为`"B服"`的资源包：
```json
"resource": [
    {
        "name": "B服",
        "path": ["./resource/base"]
    }
]
```
虽然在当前的`task`配置中，大多数任务没有显式指定`resource`字段（意味着它们在所有资源包中都可用），但该字段的设计为未来的扩展提供了可能性。例如，可以创建一个名为`"活动服"`的资源包，并将“每日活动作战”等特定活动任务绑定到此资源包，这样这些任务就只会在用户选择“活动服”资源包时才显示和可用，实现了环境的精确适配。

**Section sources**
- [interface.json](file://assets/interface.json#L29-L34)
- [ProjectInterfaceV2协议.md](file://instructions/maafw-guide/3.3-ProjectInterfaceV2协议.md#L282-L287)

## 字段交互与任务执行流程
任务的各个配置字段并非孤立存在，而是协同工作，共同驱动任务的执行。以“领取邮件”任务为例，其执行流程清晰地展示了各字段的交互：

1.  **用户触发**：用户在界面上看到`label`为“领取邮件”的任务。
2.  **入口定位**：系统根据`entry`字段的值`"领取邮件_开始"`，在`领取邮件.json`流水线中找到对应的起始节点。
3.  **条件检查**：`领取邮件_开始`节点会触发`领取邮件_周期检查`节点，该节点通过自定义动作`periodic_check`检查今日是否已执行过此任务。
4.  **流程分支**：
    -   如果已执行，`领取邮件_周期检查`会跳转到`领取邮件_周期提醒`，提示用户“今日已领取邮件”，然后直接跳转到`返回主界面`。
    -   如果未执行，则继续执行`领取邮件_点击邮件面板`等后续节点，完成领取邮件的整个流程。
5.  **状态记录**：任务成功完成后，`领取邮件_周期记录`节点会通过`record_period`动作记录本次执行，确保下次检查时能正确判断。

整个流程中，`name`确保了任务的唯一性，`default_check`保证了任务的自动执行，`description`为用户提供了操作指引，而`entry`则是启动这一系列自动化操作的“钥匙”。

```mermaid
flowchart TD
A[用户界面] --> B{显示 label: "领取邮件"}
B --> C[系统读取 entry: "领取邮件_开始"]
C --> D[加载 pipeline/领取邮件.json]
D --> E[执行 "领取邮件_开始" 节点]
E --> F[执行 "领取邮件_周期检查"]
F --> G{今日已执行?}
G --> |是| H["领取邮件_周期提醒: '今日已领取邮件'"]
G --> |否| I[执行领取邮件流程]
H --> J[跳转至 返回主界面]
I --> K[执行 "领取邮件_点击邮件面板" 等节点]
K --> L[执行 "领取邮件_周期记录"]
L --> J
```

**Diagram sources**
- [interface.json](file://assets/interface.json#L67-L72)
- [领取邮件.json](file://assets/resource/base/pipeline/日常任务/领取邮件.json)

## 结论
ProjectInterface V2协议中的任务基础配置字段构成了自动化任务系统的核心骨架。`name`作为唯一标识符，`label`作为用户界面的显示名称，`entry`作为连接配置与执行逻辑的桥梁，`default_check`作为自动化体验的关键开关，`description`作为用户友好的信息载体，以及`resource`作为环境适配的控制机制，这些字段各司其职，协同工作。通过对`assets/interface.json`及关联文件的分析，我们可以看到，这一设计不仅结构清晰、易于维护，而且通过文件路径引用和默认启用机制，极大地提升了系统的灵活性和用户体验，为实现复杂、可靠的自动化任务提供了坚实的基础。